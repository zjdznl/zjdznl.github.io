<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>sync | Z&#39;s Notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="referenceæœ¬æ–‡ä¸»è¦å†…å®¹å‚è€ƒè‡ª(æ’ååˆ†å…ˆå)ï¼š  https://golang.org/pkg/sync/ https://deepzz.com/post/golang-sync-package-usage.html#toc_4 https://colobu.com/2017/07/11/dive-into-sync-Map/#sync-Map%E7%9A%84%E6%80%A7%E8%83">
<meta property="og:type" content="article">
<meta property="og:title" content="sync">
<meta property="og:url" content="http://zjdznl.github.io/2019/01/12/sync/index.html">
<meta property="og:site_name" content="Z&#39;s Notes">
<meta property="og:description" content="referenceæœ¬æ–‡ä¸»è¦å†…å®¹å‚è€ƒè‡ª(æ’ååˆ†å…ˆå)ï¼š  https://golang.org/pkg/sync/ https://deepzz.com/post/golang-sync-package-usage.html#toc_4 https://colobu.com/2017/07/11/dive-into-sync-Map/#sync-Map%E7%9A%84%E6%80%A7%E8%83">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-01-12T15:13:58.953Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="sync">
<meta name="twitter:description" content="referenceæœ¬æ–‡ä¸»è¦å†…å®¹å‚è€ƒè‡ª(æ’ååˆ†å…ˆå)ï¼š  https://golang.org/pkg/sync/ https://deepzz.com/post/golang-sync-package-usage.html#toc_4 https://colobu.com/2017/07/11/dive-into-sync-Map/#sync-Map%E7%9A%84%E6%80%A7%E8%83">
  
    <link rel="alternate" href="/atom.xml" title="Z&#39;s Notes" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="æœç´¢"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://zjdznl.github.io"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">é¦–é¡µ</a>
        
          <a class="main-nav-link" href="/archives">å½’æ¡£</a>
        
          <a class="main-nav-link" href="/about">å…³äº</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Z&#39;s Notes</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">å¯‚é™ä¹‹åœ°</a>
        </h2>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="blog-sync" class="article article-type-blog" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/01/12/sync/" class="article-date">
  <time datetime="2019-01-12T13:42:04.000Z" itemprop="datePublished">2019-01-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      sync
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h1 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h1><p>æœ¬æ–‡ä¸»è¦å†…å®¹å‚è€ƒè‡ª(æ’ååˆ†å…ˆå)ï¼š</p>
<ol>
<li><a href="https://golang.org/pkg/sync/" target="_blank" rel="noopener">https://golang.org/pkg/sync/</a></li>
<li><a href="https://deepzz.com/post/golang-sync-package-usage.html#toc_4" target="_blank" rel="noopener">https://deepzz.com/post/golang-sync-package-usage.html#toc_4</a></li>
<li><a href="https://colobu.com/2017/07/11/dive-into-sync-Map/#sync-Map%E7%9A%84%E6%80%A7%E8%83%BD" target="_blank" rel="noopener">https://colobu.com/2017/07/11/dive-into-sync-Map/#sync-Map%E7%9A%84%E6%80%A7%E8%83%BD</a></li>
<li><a href="https://www.kancloud.cn/liupengjie/go/718991" target="_blank" rel="noopener">https://www.kancloud.cn/liupengjie/go/718991</a></li>
</ol>
<a id="more"></a>
<h1 id="overview"><a href="#overview" class="headerlink" title="overview"></a>overview</h1><p>Package sync provides basic synchronization primitives such as mutual exclusion locks. Other than the Once and WaitGroup types, most are intended for use by low-level library routines. Higher-level synchronization is better done via channels and communication.</p>
<p>Values containing the types defined in this package should not be copied.</p>
<p>ç›¸å¯¹äº channel æ¥è¿›è¡Œé€šä¿¡å’ŒåŒæ­¥ï¼Œsync æä¾›äº†æ›´åº•å±‚çš„åŒæ­¥æªæ–½ã€‚</p>
<p>âš ï¸<strong>æ³¨æ„ï¼š</strong>è¯¥åŒ…ä¸‹çš„å¯¹è±¡ï¼Œä»¥åŠåŒ…æ‹¬å…¶çš„ç»“æ„ä½“ï¼Œéƒ½ä¸èƒ½è¢«å¤åˆ¶ã€‚</p>
<p>ä¸»è¦åŒ…æ‹¬:</p>
<ol>
<li>Mutex</li>
<li>RWMutex</li>
<li>WaitGroup</li>
<li>Pool</li>
</ol>
<p>ç­‰</p>
<h1 id="Mutex"><a href="#Mutex" class="headerlink" title="Mutex"></a>Mutex</h1><p><a href="https://golang.org/pkg/sync/#Mutex" target="_blank" rel="noopener">type Mutex</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#Mutex.Lock" target="_blank" rel="noopener">func (m *Mutex) Lock()</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#Mutex.Unlock" target="_blank" rel="noopener">func (m *Mutex) Unlock()</a></p>
<p>A Mutex is a mutual exclusion lock. The zero value for a Mutex is an unlocked mutex.</p>
<p>A Mutex must not be copied after first use.</p>
<p>ä¸€ä¸ª Mutex å°±æ˜¯ä¸€ä¸ªäº’æ–¥é”ã€‚</p>
<h3 id="func-Mutex-Lock"><a href="#func-Mutex-Lock" class="headerlink" title="func (*Mutex) Lock"></a>func (*Mutex) <a href="https://golang.org/src/sync/mutex.go?s=2534:2556#L62" target="_blank" rel="noopener">Lock</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func (m *Mutex) Lock()</span><br></pre></td></tr></table></figure>
<p>Lock locks m. If the lock is already in use, the calling goroutine blocks until the mutex is available.</p>
<p>m æ˜¯ä¸å¯é‡å…¥çš„ã€‚</p>
<h3 id="func-Mutex-Unlock"><a href="#func-Mutex-Unlock" class="headerlink" title="func (*Mutex) Unlock"></a>func (*Mutex) <a href="https://golang.org/src/sync/mutex.go?s=5772:5796#L165" target="_blank" rel="noopener">Unlock</a></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func (m *Mutex) Unlock()</span><br></pre></td></tr></table></figure>
<p>Unlock unlocks m. It is a run-time error if m is not locked on entry to Unlock.</p>
<p>A locked Mutex is not associated with a particular goroutine. It is allowed for one goroutine to lock a Mutex and then arrange for another goroutine to unlock it.</p>
<p>è§£é”ä¸€ä¸ªæ²¡æœ‰è¢«é”çš„ Mutex ä¼šå¼•å‘ Panicï¼Œä¸€ä¸ª goroutine å¯ä»¥è§£å¼€å¦ä¸€ä¸ªä¸Šçš„é”ã€‚</p>
<p>ä¹Ÿå°±æ˜¯ï¼ŒMutex ä¸å’Œ goroutine ç»‘å®šã€‚</p>
<h1 id="RWMutex"><a href="#RWMutex" class="headerlink" title="RWMutex"></a>RWMutex</h1><p><a href="https://golang.org/pkg/sync/#RWMutex" target="_blank" rel="noopener">type RWMutex</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#RWMutex.Lock" target="_blank" rel="noopener">func (rw *RWMutex) Lock()</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#RWMutex.RLock" target="_blank" rel="noopener">func (rw *RWMutex) RLock()</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#RWMutex.RLocker" target="_blank" rel="noopener">func (rw *RWMutex) RLocker() Locker</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#RWMutex.RUnlock" target="_blank" rel="noopener">func (rw *RWMutex) RUnlock()</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#RWMutex.Unlock" target="_blank" rel="noopener">func (rw *RWMutex) Unlock()</a></p>
<p>A RWMutex is a reader/writer mutual exclusion lock. The lock can be held by an arbitrary number of readers or a single writer. The zero value for a RWMutex is an unlocked mutex.</p>
<p>A RWMutex must not be copied after first use.</p>
<p>If a goroutine holds a RWMutex for reading and another goroutine might call Lock, no goroutine should expect to be able to acquire a read lock until the initial read lock is released. In particular, this prohibits recursive read locking. This is to ensure that the lock eventually becomes available; a blocked Lock call excludes new readers from acquiring the lock.</p>
<p>è¯»å†™é”ï¼š</p>
<ol>
<li>è¯»å’Œå†™äº’æ–¥</li>
<li>å¯ä»¥æœ‰å¤šä¸ªè¯»è€…</li>
<li>åªèƒ½æœ‰ä¸€ä¸ªå†™è€…</li>
</ol>
<h1 id="WaitGroup"><a href="#WaitGroup" class="headerlink" title="WaitGroup"></a>WaitGroup</h1><p><a href="https://golang.org/pkg/sync/#WaitGroup" target="_blank" rel="noopener">type WaitGroup</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#WaitGroup.Add" target="_blank" rel="noopener">func (wg *WaitGroup) Add(delta int)</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#WaitGroup.Done" target="_blank" rel="noopener">func (wg *WaitGroup) Done()</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#WaitGroup.Wait" target="_blank" rel="noopener">func (wg *WaitGroup) Wait()</a></p>
<p>A WaitGroup waits for a collection of goroutines to finish. The main goroutine calls Add to set the number of goroutines to wait for. Then each of the goroutines runs and calls Done when finished. At the same time, Wait can be used to block until all goroutines have finished.</p>
<p>A WaitGroup must not be copied after first use.</p>
<p>è¿™ä¸ªå’Œ Java ä¸­çš„ CountDownLatch å¾ˆåƒï¼Œä¸»è¦ç”¨åœ¨ä¸‹é¢çš„åœºæ™¯ï¼š</p>
<p>ä¸»åç¨‹ç­‰å¾…å…¶ä»–åç¨‹æ‰§è¡Œå®Œä¹‹åå†ç»§ç»­æ‰§è¡Œã€‚</p>
<p>Example:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"sync"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        <span class="comment">// è®¡æ•°åŠ  1</span></span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">            <span class="comment">// è®¡æ•°å‡ 1</span></span><br><span class="line">            <span class="keyword">defer</span> wg.Done()</span><br><span class="line">            time.Sleep(time.Second * time.Duration(i))</span><br><span class="line">            fmt.Printf(<span class="string">"goroutine%d ç»“æŸ\n"</span>, i)</span><br><span class="line">        &#125;(i)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…æ‰§è¡Œç»“æŸ</span></span><br><span class="line">    wg.Wait()</span><br><span class="line">    fmt.Println(<span class="string">"æ‰€æœ‰ goroutine æ‰§è¡Œç»“æŸ"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Once"><a href="#Once" class="headerlink" title="Once"></a>Once</h1><p><a href="https://golang.org/pkg/sync/#Once" target="_blank" rel="noopener">type Once</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#Once.Do" target="_blank" rel="noopener">func (o *Once) Do(f func())</a></p>
<p>Once is an object that will perform exactly one action.</p>
<p>é¡¾åæ€ä¹‰ï¼ŒOnce ç”¨æ¥åšé‚£äº›åªéœ€è¦åšä¸€æ¬¡çš„æ“ä½œ.</p>
<p>æ³¨æ„ï¼ŒDo çš„å‚æ•°æ˜¯ä¸€ä¸ªæ— å‚æ•°çš„å‡½æ•°ï¼Œå¦‚æœä½ æƒ³æ‰§è¡Œå¸¦å‚æ•°çš„å‡½æ•°ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; </span><br><span class="line">	<span class="comment">// invoke other function or other logic to be executed</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢çš„ä»£ç å°†åªä¼šæ‰“å°ä¸€æ¬¡ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> once sync.Once</span><br><span class="line">	onceBody := <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">"Only once"</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			once.Do(onceBody)</span><br><span class="line">			done &lt;- <span class="literal">true</span></span><br><span class="line">		&#125;()</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		&lt;-done</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Pool"><a href="#Pool" class="headerlink" title="Pool"></a>Pool</h1><p><a href="https://golang.org/pkg/sync/#Pool" target="_blank" rel="noopener">type Pool</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#Pool.Get" target="_blank" rel="noopener">func (p *Pool) Get() interface{}</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#Pool.Put" target="_blank" rel="noopener">func (p *Pool) Put(x interface{})</a></p>
<p>å…ˆçœ‹ä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">"bytes"</span></span><br><span class="line">   <span class="string">"io"</span></span><br><span class="line">   <span class="string">"os"</span></span><br><span class="line">   <span class="string">"sync"</span></span><br><span class="line">   <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bufPool = sync.Pool&#123;</span><br><span class="line">   New: <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">   &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">timeNow</span><span class="params">()</span> <span class="title">time</span>.<span class="title">Time</span></span> &#123;</span><br><span class="line">   <span class="keyword">return</span> time.Unix(<span class="number">1136214245</span>, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Log</span><span class="params">(w io.Writer, key, val <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">   <span class="comment">// è·å–ä¸´æ—¶å¯¹è±¡ï¼Œæ²¡æœ‰çš„è¯ä¼šè‡ªåŠ¨åˆ›å»º</span></span><br><span class="line">   b := bufPool.Get().(*bytes.Buffer)</span><br><span class="line">   b.Reset()</span><br><span class="line">   b.WriteString(timeNow().UTC().Format(time.RFC3339))</span><br><span class="line">   b.WriteByte(<span class="string">' '</span>)</span><br><span class="line">   b.WriteString(key)</span><br><span class="line">   b.WriteByte(<span class="string">'='</span>)</span><br><span class="line">   b.WriteString(val)</span><br><span class="line">   w.Write(b.Bytes())</span><br><span class="line">   <span class="comment">// å°†ä¸´æ—¶å¯¹è±¡æ”¾å›åˆ° Pool ä¸­</span></span><br><span class="line">   bufPool.Put(b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   Log(os.Stdout, <span class="string">"path"</span>, <span class="string">"/search?q=flowers"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>A Pool is a set of temporary objects that may be individually saved and retrieved.</p>
<p>Any item stored in the Pool may be removed automatically at any time without notification. If the Pool holds the only reference when this happens, the item might be deallocated.</p>
<p>A Pool is safe for use by multiple goroutines simultaneously.</p>
<p>Poolâ€™s purpose is to cache allocated but unused items for later reuse, relieving pressure on the garbage collector. That is, it makes it easy to build efficient, thread-safe free lists. However, it is not suitable for all free lists.</p>
<p>An appropriate use of a Pool is to manage a group of temporary items silently shared among and potentially reused by concurrent independent clients of a package. Pool provides a way to amortize allocation overhead across many clients.</p>
<p>An example of good use of a Pool is in the fmt package, which maintains a dynamically-sized store of temporary output buffers. The store scales under load (when many goroutines are actively printing) and shrinks when quiescent.</p>
<p>On the other hand, a free list maintained as part of a short-lived object is not a suitable use for a Pool, since the overhead does not amortize well in that scenario. It is more efficient to have such objects implement their own free list.</p>
<p>A Pool must not be copied after first use.</p>
<p>ä¸»è¦ä½œç”¨æ˜¯å¯¹è±¡çš„å¤ç”¨ï¼Œæœ‰å¦‚ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p>
<ol>
<li>Pool ä¸­çš„å¯¹è±¡éšæ—¶å¯èƒ½ä¼šè¢« removeï¼Œ å¦‚æœ Pool å¯¹å…¶æœ‰å”¯ä¸€ referenceï¼Œå†…å­˜å¯èƒ½ä¹Ÿä¼šåœ¨ gc çš„æ—¶å€™è¢«å›æ”¶ã€‚è¿™ä¹Ÿå†³å®šäº†å®ƒä¸é€‚ç”¨ç¼“å­˜æœ‰çŠ¶æ€å¯¹è±¡ï¼Œæ¯”å¦‚è¿æ¥æ± ç­‰ã€‚</li>
<li>Pool æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>
<li>ä¸»è¦ä½œç”¨æ˜¯ä¸ºäº†é¿å…å¤§é‡ä¸´æ—¶å¯¹è±¡å¯¹ gcæ•ˆç‡çš„å½±å“ã€‚</li>
</ol>
<p><strong>æ·±å…¥ç†è§£çš„è¯éœ€è¦çœ‹ golang çš„å†…å­˜æ¨¡å‹å’Œè°ƒåº¦ç®—æ³•ã€gc ç®—æ³•ã€‚</strong></p>
<h1 id="Cond"><a href="#Cond" class="headerlink" title="Cond"></a>Cond</h1><p><a href="https://golang.org/pkg/sync/#Cond" target="_blank" rel="noopener">type Cond</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#NewCond" target="_blank" rel="noopener">func NewCond(l Locker) *Cond</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#Cond.Broadcast" target="_blank" rel="noopener">func (c *Cond) Broadcast()</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#Cond.Signal" target="_blank" rel="noopener">func (c *Cond) Signal()</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#Cond.Wait" target="_blank" rel="noopener">func (c *Cond) Wait()</a></p>
<p>ä¸€ä¸ªæ —å­ğŸŒ°</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sync"</span></span><br><span class="line">	<span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> count <span class="keyword">int</span> = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//ch := make(chan struct&#123;&#125;, 5)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ–°å»º cond</span></span><br><span class="line">	<span class="keyword">var</span> l sync.Mutex</span><br><span class="line">	cond := sync.NewCond(&amp;l)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">			<span class="comment">// äº‰æŠ¢äº’æ–¥é”çš„é”å®š</span></span><br><span class="line">			cond.L.Lock()</span><br><span class="line">			<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">				cond.L.Unlock()</span><br><span class="line">				<span class="comment">//ch &lt;- struct&#123;&#125;&#123;&#125;</span></span><br><span class="line">			&#125;()</span><br><span class="line"></span><br><span class="line">			<span class="comment">// æ¡ä»¶æ˜¯å¦è¾¾æˆ</span></span><br><span class="line">			<span class="keyword">for</span> count &gt; i &#123;</span><br><span class="line">				cond.Wait()</span><br><span class="line">				fmt.Printf(<span class="string">"æ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ goroutine%d\n"</span>, i)</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			fmt.Printf(<span class="string">"goroutine%d æ‰§è¡Œç»“æŸ\n"</span>, i)</span><br><span class="line">		&#125;(i)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç¡®ä¿æ‰€æœ‰ goroutine å¯åŠ¨å®Œæˆ</span></span><br><span class="line">	time.Sleep(time.Millisecond * <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// é”å®šä¸€ä¸‹</span></span><br><span class="line">	fmt.Println(<span class="string">"broadcast..."</span>)</span><br><span class="line">	cond.L.Lock()</span><br><span class="line">	count -= <span class="number">1</span></span><br><span class="line">	cond.Broadcast()</span><br><span class="line">	cond.L.Unlock()</span><br><span class="line"></span><br><span class="line">	time.Sleep(time.Second)</span><br><span class="line">	fmt.Println(<span class="string">"signal..."</span>)</span><br><span class="line">	cond.L.Lock()</span><br><span class="line">	count -= <span class="number">2</span></span><br><span class="line">	cond.Signal()</span><br><span class="line">	cond.L.Unlock()</span><br><span class="line"></span><br><span class="line">	time.Sleep(time.Second)</span><br><span class="line">	fmt.Println(<span class="string">"broadcast..."</span>)</span><br><span class="line">	cond.L.Lock()</span><br><span class="line">	count -= <span class="number">1</span></span><br><span class="line">	cond.Broadcast()</span><br><span class="line">	cond.L.Unlock()</span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">//for i := 0; i &lt; 5; i++ &#123;</span></span><br><span class="line">	<span class="comment">//	&lt;-ch</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¯èƒ½çš„ç»“æœï¼š</span></span><br><span class="line"><span class="comment">//goroutine4 æ‰§è¡Œç»“æŸ</span></span><br><span class="line"><span class="comment">//broadcast...</span></span><br><span class="line"><span class="comment">//æ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ goroutine0</span></span><br><span class="line"><span class="comment">//æ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ goroutine1</span></span><br><span class="line"><span class="comment">//æ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ goroutine2</span></span><br><span class="line"><span class="comment">//æ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ goroutine3</span></span><br><span class="line"><span class="comment">//goroutine3 æ‰§è¡Œç»“æŸ </span></span><br><span class="line"><span class="comment">//signal...</span></span><br><span class="line"><span class="comment">//æ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ goroutine0 è¿™é‡Œ signal ç”±äºåªèƒ½éšæœºé€‰ä¸€ä¸ªå”¤é†’ï¼Œ æ‰€ä»¥æ”¶åˆ°é€šçŸ¥çš„ goroutine ä¸å›ºå®š</span></span><br><span class="line"><span class="comment">//broadcast...</span></span><br><span class="line"><span class="comment">//æ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ goroutine2</span></span><br><span class="line"><span class="comment">//goroutine2 æ‰§è¡Œç»“æŸ</span></span><br></pre></td></tr></table></figure>
<p>Cond implements a condition variable, a rendezvous point for goroutines waiting for or announcing the occurrence of an event.</p>
<p>Each Cond has an associated Locker L (often a <em>Mutex or </em>RWMutex), which must be held when changing the condition and when calling the Wait method.</p>
<p>A Cond must not be copied after first use.</p>
<p>Because c.L is not locked when Wait first resumes, the caller typically cannot assume that the condition is true when Wait returns. <strong>Instead, the caller should Wait in a loop:</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">c.L.Lock()</span><br><span class="line"><span class="keyword">for</span> !condition() &#123;</span><br><span class="line">    c.Wait()</span><br><span class="line">&#125;</span><br><span class="line">... <span class="built_in">make</span> use of condition ...</span><br><span class="line">c.L.Unlock()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Cond å®ç°ä¸€ä¸ªæ¡ä»¶å˜é‡ï¼Œå³ç­‰å¾…æˆ–å®£å¸ƒäº‹ä»¶å‘ç”Ÿçš„ goroutines çš„ä¼šåˆç‚¹ï¼Œå®ƒä¼šä¿å­˜ä¸€ä¸ªé€šçŸ¥åˆ—è¡¨ã€‚åŸºæœ¬æ€æƒ³æ˜¯å½“æŸä¸­çŠ¶æ€è¾¾æˆï¼Œgoroutine å°†ä¼šç­‰å¾…ï¼ˆWaitï¼‰åœ¨é‚£é‡Œï¼Œå½“æŸä¸ªæ—¶åˆ»çŠ¶æ€æ”¹å˜æ—¶é€šè¿‡é€šçŸ¥çš„æ–¹å¼ï¼ˆBroadcastï¼ŒSignalï¼‰çš„æ–¹å¼é€šçŸ¥ç­‰å¾…çš„ goroutineã€‚è¿™æ ·ï¼Œä¸æ»¡è¶³æ¡ä»¶çš„ goroutine å”¤é†’ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œæ»¡è¶³æ¡ä»¶çš„é‡æ–°è¿›å…¥ç­‰å¾…åºåˆ—ã€‚</p>
</blockquote>
<h1 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h1><p><a href="https://golang.org/pkg/sync/#Map" target="_blank" rel="noopener">type Map</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#Map.Delete" target="_blank" rel="noopener">func (m *Map) Delete(key interface{})</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#Map.Load" target="_blank" rel="noopener">func (m *Map) Load(key interface{}) (value interface{}, ok bool)</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#Map.LoadOrStore" target="_blank" rel="noopener">func (m *Map) LoadOrStore(key, value interface{}) (actual interface{}, loaded bool)</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#Map.Range" target="_blank" rel="noopener">func (m *Map) Range(f func(key, value interface{}) bool)</a></p>
<p>â€‹    <a href="https://golang.org/pkg/sync/#Map.Store" target="_blank" rel="noopener">func (m *Map) Store(key, value interface{})</a></p>
<p>Map is like a Go <code>map[interface{}]interface{}</code> but is safe for concurrent use by multiple goroutines without additional locking or coordination. Loads, stores, and deletes run in amortized constant time.</p>
<p>The Map type is specialized. Most code should use a plain Go map instead, with separate locking or coordination, for better type safety and to make it easier to maintain other invariants along with the map content.</p>
<p>The Map type is optimized for two common use cases: (1) when the entry for a given key is only ever written once but read many times, as in caches that only grow, or (2) when multiple goroutines read, write, and overwrite entries for disjoint sets of keys. In these two cases, use of a Map may significantly reduce lock contention compared to a Go map paired with a separate Mutex or RWMutex.</p>
<p>The zero Map is empty and ready for use. A Map must not be copied after first use.</p>
<ol>
<li>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ™®é€šçš„ map åŠ ä¸Šé¢å¤–çš„ mutux å³å¯</li>
<li>sync.Map çš„ä½¿ç”¨åœºæ™¯å¦‚ä¸‹ï¼š<ul>
<li>å†™ä¸€æ¬¡è¯»å¤šæ¬¡ï¼Œä¾‹å¦‚ä¸æ–­å¢é•¿çš„ cache</li>
<li>å¤šä¸ªåç¨‹å¹¶å‘çš„ readã€writeã€overwrite äº’æ–¥çš„ key</li>
</ul>
</li>
</ol>
<p>ä¸€ä¸ªæ —å­ğŸŒ°ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">	<span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> userInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m sync.Map</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">	vv, ok := m.LoadOrStore(<span class="string">"1"</span>, <span class="string">"one"</span>)</span><br><span class="line">	fmt.Println(vv, ok) <span class="comment">//one false</span></span><br><span class="line"></span><br><span class="line">	vv, ok = m.Load(<span class="string">"1"</span>)</span><br><span class="line">	fmt.Println(vv, ok) <span class="comment">//one true</span></span><br><span class="line"></span><br><span class="line">	vv, ok = m.LoadOrStore(<span class="string">"1"</span>, <span class="string">"oneone"</span>)</span><br><span class="line">	fmt.Println(vv, ok) <span class="comment">//one true</span></span><br><span class="line"></span><br><span class="line">	vv, ok = m.Load(<span class="string">"1"</span>)</span><br><span class="line">	fmt.Println(vv, ok) <span class="comment">//one true</span></span><br><span class="line"></span><br><span class="line">	m.Store(<span class="string">"1"</span>, <span class="string">"oneone"</span>)</span><br><span class="line">	vv, ok = m.Load(<span class="string">"1"</span>)</span><br><span class="line">	fmt.Println(vv, ok) <span class="comment">// oneone true</span></span><br><span class="line"></span><br><span class="line">	m.Store(<span class="string">"2"</span>, <span class="string">"two"</span>)</span><br><span class="line">	m.Range(<span class="function"><span class="keyword">func</span><span class="params">(k, v <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">		fmt.Println(k, v)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	m.Delete(<span class="string">"1"</span>)</span><br><span class="line">	m.Range(<span class="function"><span class="keyword">func</span><span class="params">(k, v <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">		fmt.Println(k, v)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	map1 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]userInfo)</span><br><span class="line">	<span class="keyword">var</span> user1 userInfo</span><br><span class="line">	user1.Name = <span class="string">"ChamPly"</span></span><br><span class="line">	user1.Age = <span class="number">24</span></span><br><span class="line">	map1[<span class="string">"user1"</span>] = user1</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> user2 userInfo</span><br><span class="line">	user2.Name = <span class="string">"Tom"</span></span><br><span class="line">	user2.Age = <span class="number">18</span></span><br><span class="line">	m.Store(<span class="string">"map_test"</span>, map1)</span><br><span class="line"></span><br><span class="line">	mapValue, _ := m.Load(<span class="string">"map_test"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> k, v := <span class="keyword">range</span> mapValue.(<span class="keyword">interface</span>&#123;&#125;).(<span class="keyword">map</span>[<span class="keyword">string</span>]userInfo) &#123;</span><br><span class="line">		fmt.Println(k, v)</span><br><span class="line">		fmt.Println(<span class="string">"name:"</span>, v.Name)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sync.Map çš„å®ç°å‚è€ƒï¼š</p>
<p><a href="https://colobu.com/2017/07/11/dive-into-sync-Map/#sync-Map%E7%9A%84%E6%80%A7%E8%83%BD" target="_blank" rel="noopener">https://colobu.com/2017/07/11/dive-into-sync-Map/#sync-Map%E7%9A%84%E6%80%A7%E8%83%BD</a></p>
<p>è¿™ç¯‡æ–‡ç« åªä»‹ç»äº†sync åŒ…çš„ç”¨æ³•ï¼Œå…·ä½“çš„åŸç†åé¢çœ‹æƒ…å†µå†æ¨å‡ºå•ç¯‡çš„æ–‡ç« ï¼Œä¸‹ç¯‡ä¼šä»‹ç» atomic çš„ä½¿ç”¨å’ŒåŸç†ã€‚</p>
<p>ï¼ˆå®Œï¼‰</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zjdznl.github.io/2019/01/12/sync/" data-id="cjqtm2hau0008wafyz2jmne3k" class="article-share-link">åˆ†äº«</a>
      
      
      
    </footer>
  </div>
  
    
 <script src="/jquery/jquery.min.js"></script>
  <div id="random_posts">
    <h2>æ¨èæ–‡ç« </h2>
    <div class="random_posts_ul">
      <script>
          var random_count =4
          var site = {BASE_URI:'/'};
          function load_random_posts(obj) {
              var arr=site.posts;
              if (!obj) return;
              // var count = $(obj).attr('data-count') || 6;
              for (var i, tmp, n = arr.length; n; i = Math.floor(Math.random() * n), tmp = arr[--n], arr[n] = arr[i], arr[i] = tmp);
              arr = arr.slice(0, random_count);
              var html = '<ul>';
            
              for(var j=0;j<arr.length;j++){
                var item=arr[j];
                html += '<li><strong>' + 
                item.date + ':&nbsp;&nbsp;<a href="' + (site.BASE_URI+item.uri) + '">' + 
                (item.title || item.uri) + '</a></strong>';
                if(item.excerpt){
                  html +='<div class="post-excerpt">'+item.excerpt+'</div>';
                }
                html +='</li>';
                
              }
              $(obj).html(html + '</ul>');
          }
          $('.random_posts_ul').each(function () {
              var c = this;
              if (!site.posts || !site.posts.length){
                  $.getJSON(site.BASE_URI + 'js/posts.js',function(json){site.posts = json;load_random_posts(c)});
              } 
               else{
                load_random_posts(c);
              }
          });
      </script>
    </div>
  </div>

    
<nav id="article-nav">
  
  
    <a href="/2019/01/12/golang-standard-library/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">ä¸‹ä¸€ç¯‡</strong>
      <div class="article-nav-title">golang standard library </div>
    </a>
  
</nav>

  
</article>
 
     
  <div class="comments" id="comments">
    
     
       
      <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
    
       
      
      
  </div>
 
  

</section>
           
    <aside id="sidebar">
  
    

  
    
    <div class="widget-wrap">
    
      <div class="widget" id="toc-widget-fixed">
      
        <strong class="toc-title">æ–‡ç« ç›®å½•</strong>
        <div class="toc-widget-list">
              <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#reference"><span class="toc-number">1.</span> <span class="toc-text">reference</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#overview"><span class="toc-number">2.</span> <span class="toc-text">overview</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mutex"><span class="toc-number">3.</span> <span class="toc-text">Mutex</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#func-Mutex-Lock"><span class="toc-number">3.0.1.</span> <span class="toc-text">func (*Mutex) Lock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#func-Mutex-Unlock"><span class="toc-number">3.0.2.</span> <span class="toc-text">func (*Mutex) Unlock</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#RWMutex"><span class="toc-number">4.</span> <span class="toc-text">RWMutex</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WaitGroup"><span class="toc-number">5.</span> <span class="toc-text">WaitGroup</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Once"><span class="toc-number">6.</span> <span class="toc-text">Once</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Pool"><span class="toc-number">7.</span> <span class="toc-text">Pool</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cond"><span class="toc-number">8.</span> <span class="toc-text">Cond</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Map"><span class="toc-number">9.</span> <span class="toc-text">Map</span></a></li>
          </div>
      </div>
    </div>

  
    

  
    
  
    
  
    

  
    
  
    <!--å¾®ä¿¡å…¬ä¼—å·äºŒç»´ç -->


  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2014 - 2019 Jiadi Zheng&nbsp;|&nbsp;
      ä¸»é¢˜ <a href="https://github.com/giscafer/hexo-theme-cafe/" target="_blank">Cafe</a>
    </div>
     <div id="footer-right">
      è”ç³»æ–¹å¼&nbsp;|&nbsp;menghacker@gmail.com
    </div>
  </div>
</footer>
 <script src="/jquery/jquery.min.js"></script>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">é¦–é¡µ</a>
  
    <a href="/archives" class="mobile-nav-link">å½’æ¡£</a>
  
    <a href="/about" class="mobile-nav-link">å…³äº</a>
  
</nav>
    <img class="back-to-top-btn" src="/images/fly-to-top.png">
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>
      

  
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "e2fb4051c49842688ce669e634bc983f",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
    

  







<!-- author:forvoid begin -->
<!-- author:forvoid begin -->

<!-- author:forvoid end -->

<!-- author:forvoid end -->


  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      })
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      })
    </script>
    <script type="text/javascript" src="https://cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


 <script src="/js/is.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/elevator.js"></script>
  </div>
</body>
</html>